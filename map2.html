<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8" />
  <title>COVID-19 Total Cases (2020) â€” Proportional Symbols</title>
  <meta name="viewport" content="initial-scale=1,maximum-scale=1,user-scalable=no" />

  <!-- Mapbox -->
  <link href="https://api.mapbox.com/mapbox-gl-js/v2.8.1/mapbox-gl.css" rel="stylesheet" />
  <script src="https://api.mapbox.com/mapbox-gl-js/v2.8.1/mapbox-gl.js"></script>

  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: Arial, sans-serif;
    }

    #map {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 100%;
    }

    #title {
      position: absolute;
      top: 15px;
      left: 15px;
      background: rgba(255, 255, 255, 0.9);
      padding: 10px 12px;
      border-radius: 6px;
      max-width: 360px;
      font-size: 13px;
      line-height: 1.4;
    }

    #legend {
      position: absolute;
      bottom: 15px;
      right: 15px;
      background: rgba(255, 255, 255, 0.9);
      padding: 10px 12px;
      border-radius: 6px;
      width: 200px;
      font-size: 12px;
    }

    .legend-row {
      display: flex;
      align-items: center;
      margin: 8px 0;
    }

    .dot {
      border-radius: 50%;
      opacity: 0.7;
      border: 1px solid #fff;
      margin-right: 10px;
      flex: 0 0 auto;
    }

    .small {
      margin-top: 8px;
      font-size: 11px;
      color: #333;
      line-height: 1.3;
    }
  </style>
</head>

<body>

  <div id="map"></div>

  <div id="title">
    <strong>COVID-19 Total Cases (2020)</strong><br />
    County centroids shown as proportional circles sized by total cases.<br />
    <span class="small">Click a circle for details.</span>
  </div>

  <div id="legend"></div>

  <script>
    
    mapboxgl.accessToken =
      'pk.eyJ1IjoieWVhYjEiLCJhIjoiY21reW1zazkzMDhqcTNrcHM4cGN6NmxseiJ9.mpKKPYbA_AZ07E9Xhld9qA';

    const map = new mapboxgl.Map({
      container: 'map',
      style: 'mapbox://styles/mapbox/dark-v11',
      center: [-96, 37.8],
      zoom: 3,
      minZoom: 2,
      projection: 'albers'
    });

    map.addControl(new mapboxgl.NavigationControl());

    // Legend breaks 
    const breaks = [1000, 10000, 50000, 200000];
    const legendSizes = [10, 18, 28, 40]; 

    const legend = document.getElementById('legend');
    let legendHTML = `<strong>Total cases</strong>`;

    for (let i = 0; i < breaks.length; i++) {
      legendHTML += `
        <div class="legend-row">
          <span class="dot" style="width:${legendSizes[i]}px;height:${legendSizes[i]}px;background:#9e9ac8;"></span>
          ${breaks[i].toLocaleString()}+
        </div>
      `;
    }

    legendHTML += `
      <div class="small">
        Data: NYT COVID-19 (2020). Circles are county centroids.
      </div>
    `;
    legend.innerHTML = legendHTML;

    map.on('load', () => {

      map.addSource('counts', {
        type: 'geojson',
        data: 'assets/us-covid-2020-counts.json'
      });

      map.addLayer({
        id: 'cases-circles',
        type: 'circle',
        source: 'counts',
        paint: {
          
          'circle-radius': [
            'interpolate',
            ['linear'],
            ['get', 'cases'],
            0, 2,
            1000, 4,
            10000, 9,
            50000, 16,
            200000, 26
          ],
          'circle-color': [
            'interpolate',
            ['linear'],
            ['get', 'cases'],
            0, '#dadaeb',
            10000, '#9e9ac8',
            50000, '#6a51a3',
            200000, '#3f007d'
          ],
          'circle-opacity': 0.7,
          'circle-stroke-color': '#ffffff',
          'circle-stroke-width': 1
        }
      });

      // Popup on click
      map.on('click', 'cases-circles', (e) => {
        const p = e.features[0].properties;

        new mapboxgl.Popup()
          .setLngLat(e.lngLat)
          .setHTML(`
            <strong>${p.county}, ${p.state}</strong><br/>
            Total cases: <strong>${Number(p.cases).toLocaleString()}</strong><br/>
            Deaths: ${Number(p.deaths).toLocaleString()}
          `)
          .addTo(map);
      });

      map.on('mouseenter', 'cases-circles', () => map.getCanvas().style.cursor = 'pointer');
      map.on('mouseleave', 'cases-circles', () => map.getCanvas().style.cursor = '');
    });
  </script>

</body>
</html>
